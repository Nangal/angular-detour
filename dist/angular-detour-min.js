/*! angular-detour - v0.0.2 - 2013-05-24
 * https://github.com/afterglowtech/angular-detour
 * Copyright (c) 2013 [object Object];
 *    Based on and uses software code found at https://github.com/angular-ui/ui-router which is 
 *    Copyright (c) 2013, Karsten Sperling
 * Licensed MIT
 */
(function(){"use strict";function t(t,e){return f(new(f(function(){},{prototype:t})),e)}function e(t){return h(arguments,function(e){e!==t&&h(e,function(e,r){t.hasOwnProperty(r)||(t[r]=e)})}),t}function r(t,e,r){this.fromConfig=function(t,e,r){return s(t.template)?this.fromString(t.template,e):s(t.templateUrl)?this.fromUrl(t.templateUrl,e):s(t.templateProvider)?this.fromProvider(t.templateProvider,e,r):null},this.fromString=function(t,e){return l(t)?t(e):t},this.fromUrl=function(r,n){return l(r)&&(r=r(n)),null==r?null:t.get(r,{cache:e}).then(function(t){return t.data})},this.fromProvider=function(t,e,n){return r.invoke(t,null,n||{params:e})}}function n(t){function e(e){if(!/^\w+$/.test(e))throw Error("Invalid parameter name '"+e+"' in pattern '"+t+"'");if(a[e])throw Error("Duplicate parameter name '"+e+"' in pattern '"+t+"'");a[e]=!0,u.push(e)}function r(t){return t.replace(/[\\\[\]\^$*+?.()|{}]/g,"\\$&")}var n,i=/([:*])(\w+)|\{(\w+)(?:\:((?:[^{}\\]+|\\.|\{(?:[^{}\\]+|\\.)*\})+))?\}/g,a={},o="^",s=0,l=this.segments=[],u=this.params=[];this.source=t;for(var c,p,f;(n=i.exec(t))&&(c=n[2]||n[3],p=n[4]||("*"===n[1]?".*":"[^/]*"),f=t.substring(s,n.index),!(f.indexOf("?")>=0));)o+=r(f)+"("+p+")",e(c),l.push(f),s=i.lastIndex;f=t.substring(s);var d=f.indexOf("?");if(d>=0){var g=this.sourceSearch=f.substring(d);f=f.substring(0,d),this.sourcePath=t.substring(0,s+d),h(g.substring(1).split(/[&?]/),e)}else this.sourcePath=t,this.sourceSearch="";o+=r(f)+"$",l.push(f),this.regexp=RegExp(o),this.prefix=l[0]}function i(){this.compile=function(t){return new n(t)},this.isMatcher=function(t){return t instanceof n},this.$get=function(){return this}}function a(r){function n(){this._resolve={},this._children={},this._includes={},this._locals={}}function i(){this.locals={globals:{$stateParams:{}}},this.resetAll()}function a(t){var e=/^\^((?:\\[^a-zA-Z0-9]|[^\\\[\]\^$*+?.()|{}]+)*)/.exec(t.source);return null!==e?e[1].replace(/\\(.)/g,"$1"):""}function o(t,e){return t.replace(/\$(\$|\d{1,2})/,function(t,r){return e["$"===r?0:Number(r)]})}function f(t,e,r){if(!r)return!1;var n=t.invoke(e,e,{$match:r});return s(n)?n:!0}function d(t,e){return e.fullName=t,w.setState(e),this}function g(t){return w.fallback=t,this}function m(){w.initialize()}function v(t,e){return w.setChild(t,e)}function y(t){return w.updateChild(t)}function $(t){return w.setState(t)}function b(t){return w.updateState(t)}function P(t){return w.getState(t)}function _(r,n,i,a,o,s,l){function c(e,i,l){if(angular.isDefined(l)||(l=!0),e=w.getState(e),e.abstract)throw Error("Cannot transition to abstract state '"+e+"'");var u,c,d=e.path,g=y.$current,$=y.params,b=g.path,P=w.locals,_=[];for(u=0,c=d[u];c&&c===b[u]&&f(i,$,c.ownParams);u++,c=d[u])P=_[u]=c.locals;if(e===g&&P===g.locals)return y.transition=null,n.when(y.current);var j={};if(h(e.preparedParams,function(t){var e=i[t];j[t]=null!=e?e+"":null}),i=j,r.$broadcast("$stateChangeStart",e.self,i,g.self,$).defaultPrevented)return v;for(var S=n.when(P),O=u;d.length>O;O++,c=d[O])P=_[O]=t(P),S=p(c,i,c===e,S,P);var C=y.transition=S.then(function(){var t,n,c;if(y.transition!==C)return m;for(t=b.length-1;t>=u;t--)c=b[t],c.self.onExit&&a.invoke(c.self.onExit,c.self,c.locals.globals),c.locals=null;for(t=u;d.length>t;t++)n=d[t],n.locals=_[t],n.self.onEnter&&a.invoke(n.self.onEnter,n.self,n.locals.globals);y.$current=e,y.current=e.self,y.params=i,angular.copy(y.params,o),y.transition=null;var p=e.navigable;return l&&p&&s.url(p.preparedUrl.format(p.locals.globals.$stateParams)),r.$broadcast("$stateChangeSuccess",e.self,i,g.self,$),y.current},function(t){return y.transition!==C?m:(y.transition=null,r.$broadcast("$stateChangeError",e.self,i,g.self,$,t),n.reject(t))});return C}function p(t,r,o,s,u){function c(e,r){angular.forEach(e,function(e,i){f.push(n.when(angular.isString(e)?a.get(e):a.invoke(e,t.self,d)).then(function(t){r[i]=t}))}),t.dependencies&&f.push(n.when(a.invoke(l.resolveDependencies(t.dependencies),t.self,d)).then(function(){delete t.dependencies}))}var p,f=[s];o?p=r:(p={},angular.forEach(t.preparedParams,function(t){p[t]=r[t]}));var d={$stateParams:p},g=u.globals={$stateParams:p};return c(t.resolve,g),g.$$state=t,angular.forEach(t.preparedViews,function(e,r){var a=u[r]={$$controller:e.controller};f.push(n.when(i.fromConfig(e,p,d)||"").then(function(t){a.$template=t})),e.resolve!==t.resolve&&c(e.resolve,a)}),n.all(f).then(function(r){return e(u.globals,r[0].globals),h(t.preparedViews,function(t,r){e(u[r],u.globals)}),u})}function f(t,e,r){for(var n=0;r.length>n;n++){var i=r[n];if(t[i]!=e[i])return!1}return!0}function d(){var t=w.tryHandle(a,s);t&&u(t)&&s.replace().url(t)}function g(){}console.log("window.location.pathname: "+window.location.pathname),console.log("$location.path(): "+s.path());var m=n.reject(Error("transition superseded")),v=n.reject(Error("transition prevented")),y={params:{},current:w.self,$current:w,transition:null};return y.registerValue=l.registerValue,y.registerFactory=l.registerFactory,y.registerFilter=l.registerFilter,y.registerDirective=l.registerDirective,y.registerController=l.registerController,y.transitionTo=c,y.is=function(t){return y.$current===w.getState(t)},y.includes=function(t){return y.$current.includes[w.getState(t).name]},g.$inject=["$location"],r.$on("$locationChangeSuccess",d),y}Object.defineProperty(n.prototype,"needsInit",{get:function(){return this._needsInit}}),Object.defineProperty(n.prototype,"self",{get:function(){return this}}),n.prototype.resetAll=function(){this.resetFullName(),this.resetUrl(),this.resetParams(),this.resetNavigable(),this.resetPath(),this.resetViews(),this.resetIncludes(),this.resetHandlers()},n.prototype.initialize=function(t){if(this.needsInit||t){this.resetAll();for(var e in this.children)this.children[e].initialize(!0);this._needsInit=!1}},Object.defineProperty(n.prototype,"fullName",{get:function(){return this._fullName}}),Object.defineProperty(n.prototype,"name",{get:function(){return this._fullName}}),Object.defineProperty(n.prototype,"localName",{get:function(){return this._localName},set:function(t){this.validateName(t),this._localName=t,this._needsInit=!0}}),n.prototype.resetFullName=function(){this._fullName=this.parent.fullName?this.parent.fullName+"."+this.localName:this.localName},n.prototype.toString=function(){return this.fullName},n.prototype.validateName=function(t){if(!angular.isString(t)||t.indexOf("@")>=0)throw Error("Invalid local state name ("+t+")");if(this.parent&&this.parent.getChild(t))throw Error("State "+parent.fullName+" already has child "+t)},Object.defineProperty(n.prototype,"root",{get:function(){return this.parent.root}}),Object.defineProperty(n.prototype,"parent",{get:function(){return this._parent}}),Object.defineProperty(n.prototype,"children",{get:function(){return this._children},set:function(t){if(this._children=t,this._children)for(var e in this._children)this._children[e].parent=this}}),n.prototype.resetPath=function(){this._path=this.parent.path.concat(this)},Object.defineProperty(n.prototype,"path",{get:function(){return this._path}}),Object.defineProperty(n.prototype,"url",{get:function(){return this._url},set:function(t){this._url=t,this._needsInit=!0}}),Object.defineProperty(n.prototype,"fullUrl",{get:function(){return this._fullUrl}}),Object.defineProperty(n.prototype,"aliases",{get:function(){return this._aliases},set:function(t){this._aliases=t,this._needsInit=!0}}),Object.defineProperty(n.prototype,"preparedAliases",{get:function(){return this._preparedAliases},set:function(t){this._preparedAliases=t}}),Object.defineProperty(n.prototype,"preparedUrl",{get:function(){return this._preparedUrl}}),n.prototype.resetUrl=function(){if(this._preparedUrl=null,angular.isString(this.url))this._preparedUrl="^"===this.url.charAt(0)?r.compile(this.url.substring(1)):(this.parent.navigable||this.root).preparedUrl.concat(this.url);else if(c(this._url)&&l(this.url.exec)&&l(this.url.format)&&l(this.url.concat))this._preparedUrl=this.url;else if(null!=this.url)throw Error("Invalid url "+this.url+" in state "+this)},Object.defineProperty(n.prototype,"params",{get:function(){return this._params},set:function(t){this._params=t,this._needsInit=!0}}),n.prototype.resetParams=function(){this._preparedParams=null;var t=this.params;if(t){if(!p(t))throw Error("Invalid params in state '"+this+"'");if(this.preparedUrl)throw Error("Both params and url specicified in state '"+this+"'");this._perparedParams=t}else this._preparedParams=this.preparedUrl?this.preparedUrl.parameters():this.parent.preparedParams;var e={};if(h(this.preparedParams,function(t){e[t]=!0}),this.parent){var r=this;h(this.parent.preparedParams,function(t){if(!e[t])throw Error("Missing required parameter '"+t+"' in state '"+r.name+"'");e[t]=!1});var n=this._ownParams=[];h(e,function(t,e){t&&n.push(e)})}else this._ownParams=this.preparedParams},Object.defineProperty(n.prototype,"preparedParams",{get:function(){return this._preparedParams}}),Object.defineProperty(n.prototype,"ownParams",{get:function(){return this._ownParams}}),Object.defineProperty(n.prototype,"navigable",{get:function(){return this._navigable}}),n.prototype.resetNavigable=function(){this._navigable=this.url?this:this.parent?this.parent.navigable:null},Object.defineProperty(n.prototype,"resolve",{get:function(){return this._resolve},set:function(t){this._resolve=t}}),Object.defineProperty(n.prototype,"abstract",{get:function(){return this._abstract},set:function(t){this._abstract=t,this._needsInit=!0}}),Object.defineProperty(n.prototype,"includes",{get:function(){return this._includes},set:function(t){this._includes=t}}),n.prototype.resetIncludes=function(){this._includes=this.parent?angular.extend({},this.parent.includes):{}},Object.defineProperty(n.prototype,"views",{get:function(){return this._views},set:function(t){this._views=t,this._needsInit=!0}}),n.prototype.resetViews=function(){var t=this,e={},r=this.views;angular.forEach(angular.isDefined(r)?r:{"":t},function(r,n){0>n.indexOf("@")&&(n=n+"@"+t.parent.name),e[n]=r}),this._preparedViews=e},Object.defineProperty(n.prototype,"preparedViews",{get:function(){return this._preparedViews}}),Object.defineProperty(n.prototype,"handleUrl",{get:function(){return this._handleUrl}}),n.prototype._buildRule=function(t,e){var n,i;if(u(t)&&(t=r.compile(t)),r.isMatcher(t)){if(u(e))i=r.compile(e),e=["$match",function(t){return i.format(t)}];else if(!l(e)&&!p(e))throw Error("invalid 'handler' in when()");n=function(r,n){return f(r,e,t.exec(n.path(),n.search()))},n.prefix=u(t.prefix)?t.prefix:""}else{if(!(t instanceof RegExp))throw Error("invalid 'what' in when()");if(u(e))i=e,e=["$match",function(t){return o(i,t)}];else if(!l(e)&&!p(e))throw Error("invalid 'handler' in when()");if(t.global||t.sticky)throw Error("when() RegExp must not be global or sticky");n=function(r,n){return f(r,e,t.exec(n.path()))},n.prefix=a(t)}return n},n.prototype.resetHandlers=function(){if(this.abstract||!this.preparedUrl)return this._handleUrl=null,void 0;var t=this.preparedUrl,e=this,r=["$match","$detour",function(t,r){r.transitionTo(e,t,!1)}];this._handleUrl=this._buildRule(t,r),this._preparedAliases=[],this.aliases&&angular.forEach(this.aliases,function(t,r){t="^"===t.charAt(0)?t.substring(1):(e.parent.navigable||e.root).preparedUrl.concat(t).source,e.preparedAliases.push(e._buildRule(r,t))})},n.prototype.tryHandle=function(t,e){var r=!1;if(this.handleUrl){r=this.handleUrl(t,e);for(var n=0;this.preparedAliases.length>n&&!r;n++)r=this.preparedAliases[n](t,e)}if(!r)for(var i in this.children)if(r=this.children[i].tryHandle(t,e))break;return r},n.prototype.getChild=function(t){return this.children?this.children[t]:null},n.prototype.setChild=function(t,e){var r=new n;return angular.extend(r,t),this.setChildState(r,e)},n.prototype.setChildState=function(t,e){if(!e){var r=this.getChild(t.localName),n=r?r.children:null;n&&(t._children=n)}return this.children[t.localName]=t,t._parent=this,t},n.prototype.updateChild=function(t){var e=this.getChild(t.localName);return e?(angular.extend(e,t),this.setChildState(e,!1)):this.setChild(t,!0)},n.prototype.prepareFlatDefinitionAndGetParent=function(t){var e,r;if(t.parent)e=this.getState(t.parent),r=t.name;else{var n=t.fullName?t.fullName:t.name,i=/^(.*?)\.?([^\.]*)/.exec(n),a=i[1];r=i[2],e=a?this.getState(a):this.root}return t.localName=r,delete t.name,delete t.fullName,delete t.parent,e},n.prototype.setState=function(t,e){var r=this.prepareFlatDefinitionAndGetParent(t);r.setChild(t,e)},n.prototype.updateState=function(t){var e=this.prepareFlatDefinitionAndGetParent(t);e.updateChild(t)},n.prototype.findState=function(t){var e=/^([^\.]+)(\.(.*))?$/.exec(t),r=e[1];if(this.localName===r){var n=e[3];return n?this.findStateChildren(n):this}return null},n.prototype.findStateChildren=function(t){if(this.children)for(var e in this.children){var r=this.children[e].findState(t);if(r)return r}return null},n.prototype.getState=function(t){return angular.isString(t)?this.root.findStateChildren(t):this.root.findStateChildren(t.fullName)},i.prototype=new n,i.prototype.constructor=i,i.prototype.initialize=function(){for(var t in this.children)this.children[t].initialize(!1)},i.prototype.tryHandle=function(t,e){var r=this,i=n.prototype.tryHandle.call(r,t,e);return i||this.fallback&&(i=this.fallback(t,e)),i},Object.defineProperty(i.prototype,"fallback",{get:function(){return this._fallback},set:function(t){if(u(t)){var e=t;this._fallback=function(){return e}}else if(!l(rule))throw Error("'rule' must be a function")}}),i.prototype.resetFullName=function(){},i.prototype.resetPath=function(){},Object.defineProperty(i.prototype,"name",{get:function(){return""}}),Object.defineProperty(i.prototype,"localName",{get:function(){return""}}),Object.defineProperty(i.prototype,"url",{get:function(){return"^"}}),Object.defineProperty(i.prototype,"views",{get:function(){return{}}}),Object.defineProperty(i.prototype,"abstract",{get:function(){return!0}}),Object.defineProperty(i.prototype,"path",{get:function(){return[]}}),Object.defineProperty(i.prototype,"root",{get:function(){return this}}),Object.defineProperty(i.prototype,"isRoot",{get:function(){return!0}}),Object.defineProperty(i.prototype,"fullName",{get:function(){return null}}),Object.defineProperty(i.prototype,"navigable",{get:function(){return null}});var w=new i;this.state=d,this.otherwise=g,this.initialize=m,this.setChild=v,this.updateChild=y,this.setState=$,this.updateState=b,this.getState=P,_.$inject=["$rootScope","$q","$templateFactory","$injector","$stateParams","$location","$couchPotato"],this.$get=_}function o(t,e,r,n,i){var a;try{a=n.get("$animator")}catch(o){}var l={restrict:"ECA",terminal:!0,link:function(n,o,u){function c(a){var s=t.$current&&t.$current.locals[f];if(s!==h)if(p&&(g&&a?g.leave(o.contents(),o):o.html(""),p.$destroy(),p=null),s){h=s,v.state=s.$$state;var l;g&&a?(l=angular.element("<div></div>").html(s.$template).contents(),g.enter(l,o)):(o.html(s.$template),l=o.contents());var u=e(l);if(p=n.$new(),s.$$controller){s.$scope=p;var c=r(s.$$controller,s);o.children().data("$ngControllerController",c)}u(p),p.$emit("$viewContentLoaded"),p.$eval(d),i()}else h=null,v.state=null}var p,h,f=u[l.name]||u.name||"",d=u.onload||"",g=s(a)&&a(n,u),m=o.parent().inheritedData("$uiView");0>f.indexOf("@")&&(f=f+"@"+(m?m.state.name:""));var v={name:f,state:null};o.data("$uiView",v),n.$on("$stateChangeSuccess",function(){c(!0)}),c(!1)}};return l}(function(){function t(t,e,r,n){function i(t){r.value.apply(null,t)}function a(t){r.factory.apply(null,t)}function o(t){n.register.apply(null,t)}function s(t){e.directive.apply(null,t)}function l(e){t.register.apply(null,e)}function u(t){function e(e,r){var n=e.defer();return require(t,function(){n.resolve(),r.$apply()}),n.promise}return e.$inject=["$q","$rootScope"],e}function c(t){if(t.dependencies){var e=t,r=t.dependencies;return delete e.dependencies,e.resolve={},e.resolve.delay=u(r),e}return t}this.resolveDependencies=u,this.resolveDependenciesProperty=c,this.$get=function(){var t={};return t.registerValue=i,t.registerFactory=a,t.registerFilter=o,t.registerDirective=s,t.registerController=l,t.resolveDependenciesProperty=c,t.resolveDependencies=u,t}}var e=angular.module("agt.couchPotato",["ng"]);t.$inject=["$controllerProvider","$compileProvider","$provide","$filterProvider"],e.provider("$couchPotato",t)})();var s=angular.isDefined,l=angular.isFunction,u=angular.isString,c=angular.isObject,p=angular.isArray,h=angular.forEach,f=angular.extend;angular.copy,angular.module("agt.detour",["ng","agt.couchPotato"]),r.$inject=["$http","$templateCache","$injector"],angular.module("agt.detour").service("$templateFactory",r),n.prototype.concat=function(t){return new n(this.sourcePath+t+this.sourceSearch)},n.prototype.toString=function(){return this.source},n.prototype.exec=function(t,e){var r=this.regexp.exec(t);if(!r)return null;var n,i=this.params,a=i.length,o=this.segments.length-1,s={};for(n=0;o>n;n++)s[i[n]]=decodeURIComponent(r[n+1]);for(;a>n;n++)s[i[n]]=e[i[n]];return s},n.prototype.parameters=function(){return this.params},n.prototype.format=function(t){var e=this.segments,r=this.params;if(!t)return e.join("");var n,i,a,o=e.length-1,s=r.length,l=e[0];for(n=0;o>n;n++)a=t[r[n]],null!=a&&(l+=a),l+=e[n+1];for(;s>n;n++)a=t[r[n]],null!=a&&(l+=(i?"&":"?")+r[n]+"="+encodeURIComponent(a),i=!0);return l},angular.module("agt.detour").provider("$urlMatcherFactory",i),a.$inject=["$urlMatcherFactoryProvider","$locationProvider"],angular.module("agt.detour").value("$stateParams",{}).provider("$detour",a),o.$inject=["$detour","$compile","$controller","$injector","$anchorScroll"],angular.module("agt.detour").directive("uiView",o)})();