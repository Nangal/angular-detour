/*! angular-detour - v0.3.1 - 2013-06-05
 * https://github.com/afterglowtech/angular-detour
 * Copyright (c) 2013 Stu Salsbury;
 *    Based on and uses software code found at https://github.com/angular-ui/ui-router which is 
 *    Copyright (c) 2013, Karsten Sperling
 * Licensed MIT
 */

/**
 * almond 0.2.5 Copyright (c) 2011-2012, The Dojo Foundation All Rights Reserved.
 * Available via the MIT or new BSD license.
 * see: http://github.com/jrburke/almond for details
 */

/*! angular-couchPotato - v0.0.4 - 2013-05-29
 * https://github.com/afterglowtech/angular-couchPotato
 * Copyright (c) 2013 Stu Salsbury;
 *    Uses software code found at https://github.com/szhanginrhythm/angular-require-lazyload
 * Licensed MIT
 */

(function(){var e,t,n;(function(r){function d(e,t){return h.call(e,t)}function v(e,t){var n,r,i,s,o,u,a,f,c,h,p=t&&t.split("/"),d=l.map,v=d&&d["*"]||{};if(e&&e.charAt(0)===".")if(t){p=p.slice(0,p.length-1),e=p.concat(e.split("/"));for(f=0;f<e.length;f+=1){h=e[f];if(h===".")e.splice(f,1),f-=1;else if(h===".."){if(f===1&&(e[2]===".."||e[0]===".."))break;f>0&&(e.splice(f-1,2),f-=2)}}e=e.join("/")}else e.indexOf("./")===0&&(e=e.substring(2));if((p||v)&&d){n=e.split("/");for(f=n.length;f>0;f-=1){r=n.slice(0,f).join("/");if(p)for(c=p.length;c>0;c-=1){i=d[p.slice(0,c).join("/")];if(i){i=i[r];if(i){s=i,o=f;break}}}if(s)break;!u&&v&&v[r]&&(u=v[r],a=f)}!s&&u&&(s=u,o=a),s&&(n.splice(0,o,s),e=n.join("/"))}return e}function m(e,t){return function(){return s.apply(r,p.call(arguments,0).concat([e,t]))}}function g(e){return function(t){return v(t,e)}}function y(e){return function(t){a[e]=t}}function b(e){if(d(f,e)){var t=f[e];delete f[e],c[e]=!0,i.apply(r,t)}if(!d(a,e)&&!d(c,e))throw new Error("No "+e);return a[e]}function w(e){var t,n=e?e.indexOf("!"):-1;return n>-1&&(t=e.substring(0,n),e=e.substring(n+1,e.length)),[t,e]}function E(e){return function(){return l&&l.config&&l.config[e]||{}}}var i,s,o,u,a={},f={},l={},c={},h=Object.prototype.hasOwnProperty,p=[].slice;o=function(e,t){var n,r=w(e),i=r[0];return e=r[1],i&&(i=v(i,t),n=b(i)),i?n&&n.normalize?e=n.normalize(e,g(t)):e=v(e,t):(e=v(e,t),r=w(e),i=r[0],e=r[1],i&&(n=b(i))),{f:i?i+"!"+e:e,n:e,pr:i,p:n}},u={require:function(e){return m(e)},exports:function(e){var t=a[e];return typeof t!="undefined"?t:a[e]={}},module:function(e){return{id:e,uri:"",exports:a[e],config:E(e)}}},i=function(e,t,n,i){var s,l,h,p,v,g=[],w;i=i||e;if(typeof n=="function"){t=!t.length&&n.length?["require","exports","module"]:t;for(v=0;v<t.length;v+=1){p=o(t[v],i),l=p.f;if(l==="require")g[v]=u.require(e);else if(l==="exports")g[v]=u.exports(e),w=!0;else if(l==="module")s=g[v]=u.module(e);else if(d(a,l)||d(f,l)||d(c,l))g[v]=b(l);else{if(!p.p)throw new Error(e+" missing "+l);p.p.load(p.n,m(i,!0),y(l),{}),g[v]=a[l]}}h=n.apply(a[e],g);if(e)if(s&&s.exports!==r&&s.exports!==a[e])a[e]=s.exports;else if(h!==r||!w)a[e]=h}else e&&(a[e]=n)},e=t=s=function(e,t,n,a,f){return typeof e=="string"?u[e]?u[e](t):b(o(e,t).f):(e.splice||(l=e,t.splice?(e=t,t=n,n=null):e=r),t=t||function(){},typeof n=="function"&&(n=a,a=f),a?i(r,e,t,n):setTimeout(function(){i(r,e,t,n)},4),s)},s.config=function(e){return l=e,l.deps&&s(l.deps,l.callback),s},n=function(e,t,n){t.splice||(n=t,t=[]),!d(a,e)&&!d(f,e)&&(f[e]=[e,t,n])},n.amd={jQuery:!0}})(),n("almond",function(){}),n("common",[],function(){function e(){function e(e){return typeof e=="function"}function t(e){return!e||typeof e.length!="number"?!1:typeof e.hasOwnProperty!="function"&&typeof e.constructor!="function"?!0:typeof e=="JQLite"||typeof jQuery!="undefined"&&typeof e=="jQuery"||toString.call(e)!=="[object Object]"||typeof e.callee=="function"}function n(r,i,s){var o;if(r)if(e(r))for(o in r)o!=="prototype"&&o!=="length"&&o!=="name"&&r.hasOwnProperty(o)&&i.call(s,r[o],o);else if(r.forEach&&r.forEach!==n)r.forEach(i,s);else if(t(r))for(o=0;o<r.length;o++)i.call(s,r[o],o);else for(o in r)r.hasOwnProperty(o)&&i.call(s,r[o],o);return r}function r(e,t){t?e.$$hashKey=t:delete e.$$hashKey}function i(e){var t=e.$$hashKey;return n(arguments,function(t){t!==e&&n(t,function(t,n){e[n]=t})}),r(e,t),e}function s(e,t){var r=Array.isArray(t),i=r&&[]||{};return r?(e=e||[],i=i.concat(e),n(t,function(t,n){typeof t=="object"?i[n]=s(e[n],t):e.indexOf(t)===-1&&i.push(t)})):(e&&typeof e=="object"&&n(Object.keys(e),function(t){i[t]=e[t]}),n(Object.keys(t),function(n){typeof t[n]!="object"||!t[n]?i[n]=t[n]:e[n]?i[n]=s(e[n],t[n]):i[n]=t[n]})),i}this.isDefined=function(e){return typeof e!="undefined"},this.isFunction=e,this.isString=function(e){return typeof e=="string"},this.isObject=function(e){return e!=null&&typeof e=="object"},this.isArray=function(e){return toString.apply(e)==="[object Array]"},this.isArrayLike=t,this.forEach=n,this.setHashKey=r,this.extend=i,this.inherit=function(e,t){return i(new(i(function(){},{prototype:e})),t)},this.deepMerge=s,this.merge=function(e){return n(arguments,function(t){t!==e&&n(t,function(t,n){e.hasOwnProperty(n)||(e[n]=t)})}),e}}return new e}),n("UrlMatcher",["common"],function(e){function t(t){function f(e){if(!/^\w+$/.test(e))throw new Error("Invalid parameter name '"+e+"' in pattern '"+t+"'");if(r[e])throw new Error("Duplicate parameter name '"+e+"' in pattern '"+t+"'");r[e]=!0,a.push(e)}function l(e){return e.replace(/[\\\[\]\^$*+?.()|{}]/g,"\\$&")}var n=/([:*])(\w+)|\{(\w+)(?:\:((?:[^{}\\]+|\\.|\{(?:[^{}\\]+|\\.)*\})+))?\}/g,r={},i="^",s=0,o,u=this.segments=[],a=this.params=[];this.source=t;var c,h,p;while(o=n.exec(t)){c=o[2]||o[3],h=o[4]||(o[1]==="*"?".*":"[^/]*"),p=t.substring(s,o.index);if(p.indexOf("?")>=0)break;i+=l(p)+"("+h+")",f(c),u.push(p),s=n.lastIndex}p=t.substring(s);var d=p.indexOf("?");if(d>=0){var v=this.sourceSearch=p.substring(d);p=p.substring(0,d),this.sourcePath=t.substring(0,s+d),e.forEach(v.substring(1).split(/[&?]/),f)}else this.sourcePath=t,this.sourceSearch="";i+=l(p)+"$",u.push(p),this.regexp=new RegExp(i),this.prefix=u[0]}return t.prototype.concat=function(e){return new t(this.sourcePath+e+this.sourceSearch)},t.prototype.toString=function(){return this.source},t.prototype.exec=function(e,t){var n=this.regexp.exec(e);if(!n)return null;var r=this.params,i=r.length,s=this.segments.length-1,o={},u;for(u=0;u<s;u++)o[r[u]]=decodeURIComponent(n[u+1]);for(;u<i;u++)o[r[u]]=t[r[u]];return o},t.prototype.parameters=function(){return this.params},t.prototype.format=function(e){var t=this.segments,n=this.params;if(!e)return t.join("");var r=t.length-1,i=n.length,s=t[0],o,u,a;for(o=0;o<r;o++)a=e[n[o]],a!=null&&(s+=a),s+=t[o+1];for(;o<i;o++)a=e[n[o]],a!=null&&(s+=(u?"&":"?")+n[o]+"="+encodeURIComponent(a),u=!0);return s},t.prototype.isMatcher=function(e){return e instanceof t},t}),n("StateBase",["./common","UrlMatcher"],function(e,t){function r(){this.children={}}var n="abstract";return Object.defineProperty(r.prototype,"self",{get:function(){return this}}),r.prototype.resetAll=function(){this.resetFullName(),this.resetUrl(),this.resetParams(),this.resetNavigable(),this.resetPath(),this.resetViews(),this.resetIncludes(),this.resetHandlers()},r.prototype.initialize=function(e){if(this.needsInit||e){this.resetAll();for(var t in this.children)this.children[t].initialize(!0);this.needsInit=!1}},Object.defineProperty(r.prototype,"fullName",{get:function(){return this._fullName}}),Object.defineProperty(r.prototype,"name",{get:function(){return this._fullName}}),Object.defineProperty(r.prototype,"localName",{get:function(){return this._localName},set:function(e){this.validateName(e),this._localName=e,this.needsInit=!0}}),r.prototype.resetFullName=function(){this._fullName=this.parent.fullName?this.parent.fullName+"."+this.localName:this.localName},r.prototype.toString=function(){return this.fullName},r.prototype.validateName=function(t){if(!e.isString(t)||t.indexOf("@")>=0)throw new Error("Invalid local state name ("+t+")")},Object.defineProperty(r.prototype,"root",{get:function(){return this.parent.root}}),Object.defineProperty(r.prototype,"children",{get:function(){return this._children},set:function(e){this._children=e;if(this._children)for(var t in this._children)this._children[t].parent=this}}),r.prototype.resetPath=function(){this.path=this.parent.path.concat(this)},Object.defineProperty(r.prototype,"url",{get:function(){return this._url},set:function(e){this._url=e,this.needsInit=!0}}),Object.defineProperty(r.prototype,"aliases",{get:function(){return this._aliases},set:function(e){this._aliases=e,this.needsInit=!0}}),r.prototype.resetUrl=function(){this.preparedUrl=null;if(e.isString(this.url))this.url.charAt(0)==="^"?this.preparedUrl=new t(this.url.substring(1)):this.preparedUrl=(this.parent.navigable||this.root).preparedUrl.concat(this.url);else if(e.isObject(this.url)&&e.isFunction(this.url.exec)&&e.isFunction(this.url.format)&&e.isFunction(this.url.concat))this.preparedUrl=this.url;else if(this.url!=null)throw new Error("Invalid url "+this.url+" in state "+this)},Object.defineProperty(r.prototype,"params",{get:function(){return this._params},set:function(e){this._params=e,this.needsInit=!0}}),r.prototype.resetParams=function(){this.preparedParams=null;var t=this.params;if(t){if(!e.isArray(t))throw new Error("Invalid params in state '"+this+"'");if(this.preparedUrl)throw new Error("Both params and url specicified in state '"+this+"'");this.perparedParams=t}else this.preparedParams=this.preparedUrl?this.preparedUrl.parameters():this.parent.preparedParams;var n={};e.forEach(this.preparedParams,function(e){n[e]=!0});if(this.parent){var r=this;e.forEach(this.parent.preparedParams,function(e){if(!n[e])throw new Error("Missing required parameter '"+e+"' in state '"+r.name+"'");n[e]=!1});var i=this.ownParams=[];e.forEach(n,function(e,t){e&&i.push(t)})}else this.ownParams=this.preparedParams},r.prototype.resetNavigable=function(){this.navigable=this.url?this:this.parent?this.parent.navigable:null},Object.defineProperty(r.prototype,n,{get:function(){return this._abstract},set:function(e){this._abstract=e,this.needsInit=!0}}),r.prototype.resetIncludes=function(){this.includes=this.parent?e.extend({},this.parent.includes):{},this.includes[this.name]=!0},Object.defineProperty(r.prototype,"views",{get:function(){return this._views},set:function(e){this._views=e,this.needsInit=!0}}),r.prototype.resetViews=function(){var t=this,n={},r=this.views;e.forEach(e.isDefined(r)?r:{"":t},function(e,r){r.indexOf("@")<0&&(r=r+"@"+t.parent.name),n[r]=e}),this.preparedViews=n},r.prototype.resetHandlers=function(){throw new Error('not implemented: "resetHandlers"')},r.prototype.newInstance=function(){return new r},r.prototype.getChild=function(e){return this.children?this.children[e]:null},r.prototype.setChild=function(t,n){var r=this.newInstance();return e.extend(r,t),this.setChildState(r,n)},r.prototype.removeChild=function(e){return this.children[e]&&delete this.children[e],this},r.prototype.setChildState=function(e,t){if(!t){var n=this.getChild(e.localName),r=n?n.children:null;r&&(e._children=r)}return this.children[e.localName]=e,e.parent=this,this.needsInit=!0,e},r.prototype.updateChild=function(t){var n=this.getChild(t.localName);return n?(e.extend(n,t),this.setChildState(n,!1)):this.setChild(t,!0)},r.prototype.prepFlatGetParent=function(e){var t,n;if(e.parent)t=this.getState(e.parent),n=e.fullName;else{var r=e.fullName?e.fullName:e.name,i=/^(.*?)\.?([^\.]*)$/.exec(r),s=i[1];n=i[2],t=s?this.getState(s):this.root}return e.localName=n,delete e.name,delete e.fullName,delete e.parent,t},r.prototype.setState=function(e,t){var n=this.prepFlatGetParent(e);return n.setChild(e,t)},r.prototype.updateState=function(e){var t=this.prepFlatGetParent(e);return t.updateChild(e)},r.prototype.findState=function(e){var t=/^([^\.]+)(\.(.*))?$/.exec(e),n=t[1];if(this.localName===n){var r=t[3];return r?this.findStateChildren(r):this}return null},r.prototype.findStateChildren=function(e){if(this.children)for(var t in this.children){var n=this.children[t].findState(e);if(n)return n}return null},r.prototype.getState=function(t){return e.isString(t)?this.root.findStateChildren(t):this.root.findStateChildren(t.fullName)},r.prototype.getIntJson=function(e,t,n){return e[n]?parseInt(e[n],10):e[t]?parseInt(e[t],10):null},r.prototype.getObjJson=function(e,t,n){return e[n]?e[n]:e[t]?e[t]:null},r.prototype.expandDefinition=function(e){this.expandJson(e,"url","u"),this.expandJson(e,"dependencies","d"),this.expandJson(e,"resolveByService","r"),this.expandJson(e,"templateService","i"),this.expandJson(e,"aliases","s"),this.expandJson(e,"controller","c"),this.expandJson(e,"templateUrl","t"),this.expandJson(e,"template","l"),this.expandJson(e,"data","a"),this.expandJson(e,"abstract","b"),this.expandJson(e,"views","v")},r.prototype.expandView=function(e){this.expandJson(e,"url","u"),this.expandJson(e,"resolveByService","r"),this.expandJson(e,"templateService","i"),this.expandJson(e,"controller","c"),this.expandJson(e,"templateUrl","t"),this.expandJson(e,"template","l"),this.expandJson(e,"data","a")},r.prototype.expandJson=function(e,t,n){e[n]&&(e[t]=e[n],delete e[n])},r.prototype.mergeChild=function(e,t){var n=this.getObjJson(t,"delete","x");if(n)this.removeChild(e);else{var r=this.getObjJson(t,"definition","d");if(r){r.localName=e,this.expandDefinition(r);if(r.views)for(var i in r.views){var s=r.views[i];this.expandView(s)}this.updateChild(r)}var o=this.getObjJson(t,"children","c");if(o){var u=this.getChild(e);for(var a in o){var f=o[a];u.mergeChild(a,f)}}}return!0},Object.defineProperty(r.prototype,"knownStates",{get:function(){var e={};if(Object.keys(this.children).length>0){var t={};for(var n in this.children){var r=this.children[n];t[r.localName]=r.knownStates}e=t}return e}}),r}),function(){function e(e,n,r,i){function s(e){r.value.apply(null,e)}function o(e){r.factory.apply(null,e)}function u(e){i.register.apply(null,e)}function a(e){n.directive.apply(null,e)}function f(t){e.register.apply(null,t)}function l(e){function n(n,r){var i=n.defer();return t(e,function(){i.resolve(),r.$apply()}),i.promise}return n.$inject=["$q","$rootScope"],n}function c(e){if(e.dependencies){var t=e,n=e.dependencies;return delete t.dependencies,t.resolve={},t.resolve.delay=l(n),t}return e}this.resolveDependencies=l,this.resolveDependenciesProperty=c,this.$get=function(){var e={};return e.registerValue=s,e.registerFactory=o,e.registerFilter=u,e.registerDirective=a,e.registerController=f,e.resolveDependenciesProperty=c,e.resolveDependencies=l,e}}var n=angular.module("agt.couchPotato",["ng"]);e.$inject=["$controllerProvider","$compileProvider","$provide","$filterProvider"],n.provider("$couchPotato",e)}(),n("couchPotato",function(){}),n("detourModule",["couchPotato"],function(){return angular.module("agt.detour",["agt.couchPotato"])}),n("templateFactory",["./detourModule"],function(){function e(e,t,n){this.fromConfig=function(e,t,n){return angular.isDefined(e.template)?this.fromString(e.template,t):angular.isDefined(e.templateUrl)?this.fromUrl(e.templateUrl,t):angular.isDefined(e.templateProvider)?this.fromProvider(e.templateProvider,t,n):angular.isDefined(e.templateService)?this.fromService(e.templateService,t,n):null},this.fromString=function(e,t){return angular.isFunction(e)?e(t):e},this.fromUrl=function(n,r){return angular.isFunction(n)&&(n=n(r)),n==null?null:e.get(n,{cache:t}).then(function(e){return e.data})},this.fromProvider=function(e,t,r){return n.invoke(e,null,r||{params:t})},this.fromService=function(e,t,r){return n.invoke([e,function(e){return e.getTemplate(t,r)}])}}e.$inject=["$http","$templateCache","$injector"],angular.module("agt.detour").service("$templateFactory",e)}),n("detourProvider",["./common","UrlMatcher","StateBase","couchPotato","templateFactory","./detourModule"],function(e,t,n){function o(){function u(){this.children={}}function a(){this.locals={globals:{$stateParams:{}}},this.serial=0,this.resetAll()}function f(e){var t=/^\^((?:\\[^a-zA-Z0-9]|[^\\\[\]\^$*+?.()|{}]+)*)/.exec(e.source);return t!==null?t[1].replace(/\\(.)/g,"$1"):""}function l(e,t){return e.replace(/\$(\$|\d{1,2})/,function(e,n){return t[n==="$"?0:Number(n)]})}function c(t,n,r){if(!r)return!1;var i=t.invoke(n,n,{$match:r});return e.isDefined(i)?i:!0}function p(e,t){return t.fullName=e,h.setState(t),this}function d(e){return h.fallback=e,this}function v(){h.initialize()}function m(e){var t=this.getState(e);return t&&t.parent.removeChild(t.localName),this}function g(e){return h.setState(e)}function y(e){return h.updateState(e)}function b(e){return h.getState(e)}function w(e){return h.mergeJson(e)}function S(t,n,r,i,s,u,a,f){function T(e){var t=n.defer(),r=null;return E.crossDomain?(r=angular.copy(x,r),delete r.headers.common["X-Requested-With"],r.useXDomain=!0):r=x,f({method:E.httpMethod,url:e,config:r}).success(function(e,n,r,i){t.resolve(angular.fromJson(e))}).error(function(e,n,r,i){t.resolve(null)}),t.promise}function N(e){var t=E.lazy.routeUrl+"?"+E.lazy.routeParameter+"="+encodeURIComponent(e)+"&"+E.knownStatesParameter+"="+encodeURIComponent(angular.toJson(h.knownStates)),r=n.defer();return T(t).then(function(e){e&&h.mergeJson(e),r.resolve()}),r.promise}function C(e){var t=E.lazy.stateUrl+"?"+E.lazy.stateParameter+"="+encodeURIComponent(e)+"&"+E.knownStatesParameter+"="+encodeURIComponent(angular.toJson(h.knownStates)),r=n.defer();return T(t).then(function(e){e&&h.mergeJson(e),r.resolve()}),r.promise}function k(r,o,a,f){var p=h.getState(r);if(!p&&E.lazy.enabled&&!f)return C(r).then(function(){return k(r,o,a,!0)});r=p,e.isDefined(a)||(a=!0);if(r["abstract"])throw new Error("Cannot transition to abstract state '"+r+"'");var d=r.path,v=S.$current,m=S.params,g=v.path,y,b,w=h.locals,x=[];for(y=0,b=d[y];b&&b===g[y]&&O(o,m,b.ownParams);y++,b=d[y])w=x[y]=b.locals;if(r===v&&w===v.locals)return S.transition=null,n.when(S.current);o=A(r.preparedParams,o||{});if(t.$broadcast("$stateChangeStart",r.self,o,v.self,m).defaultPrevented)return c;var T=n.when(w);for(var N=y;N<d.length;N++,b=d[N])w=x[N]=e.inherit(w),T=L(b,o,b===r,T,w);var M=S.transition=T.then(function(){var e,n,f;if(S.transition!==M)return l;for(e=g.length-1;e>=y;e--)f=g[e],f.self.onExit&&i.invoke(f.self.onExit,f.self,f.locals.globals),f.locals=null;for(e=y;e<d.length;e++)n=d[e],n.locals=x[e],n.self.onEnter&&i.invoke(n.self.onEnter,n.self,n.locals.globals);S.$current=r,S.current=r.self,S.params=o,angular.copy(S.params,s),S.transition=null;var c=r.navigable;return a&&c&&u.url(c.preparedUrl.format(c.locals.globals.$stateParams)),t.$broadcast("$stateChangeSuccess",r.self,o,v.self,m),S.current},function(e){return S.transition!==M?l:(S.transition=null,t.$broadcast("$stateChangeError",r.self,o,v.self,m,e),n.reject(e))});return M}function L(t,s,o,u,f){var l=[];return t.dependencies&&l.push(n.when(i.invoke(a.resolveDependencies(t.dependencies)))),n.all(l).then(function(){function h(r,s){e.forEach(r,function(r,o){a.push(n.when(e.isString(r)?i.get(r):i.invoke(r,t.self,c)).then(function(e){s[o]=e}))})}function p(t,r){e.forEach(t,function(e,t){a.push(n.when(i.invoke([e,function(e){return e.resolve(l,c)}])).then(function(e){r[t]=e}))})}var a=[u],l;o?l=s:(l={},e.forEach(t.preparedParams,function(e){l[e]=s[e]}));var c={$stateParams:l},d=f.globals={$stateParams:l};return h(t.resolve,d),p(t.resolveByService,d),d.$$state=t,e.forEach(t.preparedViews,function(e,i){var s=f[i]={$$controller:e.controller};a.push(n.when(r.fromConfig(e,l,c)||"").then(function(e){s.$template=e})),e.resolve!==t.resolve&&h(e.resolve,s)}),n.all(a).then(function(n){return e.merge(f.globals,n[0].globals),e.forEach(t.preparedViews,function(t,n){e.merge(f[n],f.globals)}),f})})}function A(t,n){var r={};return e.forEach(t,function(e){var t=n[e];r[e]=t!=null?String(t):null}),r}function O(e,t,n){for(var r=0;r<n.length;r++){var i=n[r];if(e[i]!=t[i])return!1}return!0}function M(t,n,r,s){var o=!E.lazy.enabled||s,a=h.tryHandle(i,u,o);a&&e.isString(a)&&u.replace().url(a),!a&&!s&&E.lazy.enabled&&N(u.path()).then(function(){M(t,n,r,!0)})}var l=n.reject(new Error("transition superseded")),c=n.reject(new Error("transition prevented")),E=o.loader,S={params:{},current:h.self,$current:h,stateLoader:E,transition:null};S.registerValue=a.registerValue,S.registerFactory=a.registerFactory,S.registerFilter=a.registerFilter,S.registerDirective=a.registerDirective,S.registerController=a.registerController,S.state=p,S.otherwise=d,S.initialize=v,S.setState=g,S.updateState=y,S.getState=b,S.removeState=m,S.mergeJson=w;var x=f.defaults;return S.transitionTo=k,S.is=function(e){return S.$current===h.getState(e)},S.includes=function(e){var t=h.getState(e);return t?S.$current.includes[t.name]:!1},S.href=function(e,t){var n=this.getState(e),r=n.navigable;if(!r)throw new Error("State '"+n+"' is not navigable");return r.url.format(A(n.preparedParams,t||{}))},t.$on("$locationChangeSuccess",M),S}var o=this;u.prototype=new n,u.prototype.constructor=u,u.prototype.newInstance=function(){return new u},u.prototype._buildRule=function(n,i){var s,o;e.isString(n)&&(n=new t(n));if(n instanceof t){if(e.isString(i))o=new t(i),i=[r,function(e){return o.format(e)}];else if(!e.isFunction(i)&&!e.isArray(i))throw new Error("invalid 'handler' in when()");s=function(e,t){return c(e,i,n.exec(t.path(),t.search()))},s.prefix=e.isString(n.prefix)?n.prefix:""}else{if(!(n instanceof RegExp))throw new Error("invalid 'what' in when()");if(e.isString(i))o=i,i=[r,function(e){return l(o,e)}];else if(!e.isFunction(i)&&!e.isArray(i))throw new Error("invalid 'handler' in when()");if(n.global||n.sticky)throw new Error("when() RegExp must not be global or sticky");s=function(e,t){return c(e,i,n.exec(t.path()))},s.prefix=f(n)}return s},u.prototype.resetHandlers=function(){if(this[i]||!this.preparedUrl){this.handleUrl=null;return}var t=this.preparedUrl,n=this,o=[r,s,function(e,t){t.transitionTo(n,e,!1)}];this.handleUrl=this._buildRule(t,o),this.preparedAliases=[],this.aliases&&e.forEach(this.aliases,function(e,t){e=e.charAt(0)==="^"?e.substring(1):(n.parent.navigable||n.root).preparedUrl.concat(e).source,n.preparedAliases.push(n._buildRule(t,e))})},u.prototype.tryHandle=function(e,t){var n=!1;if(this.handleUrl){n=this.handleUrl(e,t);for(var r=0;r<this.preparedAliases.length&&!n;r++)n=this.preparedAliases[r](e,t)}if(!n)for(var i in this.children){n=this.children[i].tryHandle(e,t);if(n)break}return n},a.prototype=new u,a.prototype.constructor=a,a.prototype.initialize=function(){for(var e in this.children)this.children[e].initialize(!1);this.needsInit=!1},a.prototype.tryHandle=function(e,t,n){var r=this,i=u.prototype.tryHandle.call(r,e,t);return!i&&n&&this.fallback&&(i=this.fallback(e,t)),i},Object.defineProperty(a.prototype,"fallback",{get:function(){return this._fallback},set:function(t){if(e.isString(t)){var n=t;n?this._fallback=function(){return n}:this._fallback=null}else if(!isFunction(rule))throw new Error("'rule' must be a function")}}),a.prototype.resetFullName=function(){},a.prototype.resetPath=function(){},Object.defineProperty(a.prototype,"name",{get:function(){return""}}),Object.defineProperty(a.prototype,"localName",{get:function(){return""}}),Object.defineProperty(a.prototype,"url",{get:function(){return"^"}}),Object.defineProperty(a.prototype,"views",{get:function(){return{}}}),Object.defineProperty(a.prototype,"abstract",{get:function(){return!0}}),Object.defineProperty(a.prototype,"path",{get:function(){return[]}}),Object.defineProperty(a.prototype,"root",{get:function(){return this}}),Object.defineProperty(a.prototype,"isRoot",{get:function(){return!0}}),Object.defineProperty(a.prototype,"fullName",{get:function(){return null}}),Object.defineProperty(a.prototype,"navigable",{get:function(){return null},set:function(e){}}),a.prototype.mergeJson=function(e){var t=this.getIntJson(e,"serial","s");if(t&&t<=this.serial)return!1;var n=this.getObjJson(e,"tree","t");if(n)for(var r in n){var i=n[r];this.mergeChild(r,i)}var s=this.getObjJson(e,"fallback","f");return s&&(this.fallback=s),this.serial=t,this.initialize(),!0},Object.defineProperty(a.prototype,"knownStates",{get:function(){var e={s:this.serial,f:this.fallback},t={};for(var n in this.children){var r=this.children[n];t[n]=r.knownStates}return e.t=t,e}});var h=new a;this.state=p,this.otherwise=d,this.initialize=v,this.removeState=m,this.setState=g,this.updateState=y,this.getState=b,this.mergeJson=w;var E={lazy:{enabled:!1,routeUrl:null,stateUrl:null,routeParameter:"r",stateParameter:"s"},httpMethod:"GET",knownStatesParameter:"k",updatesUrl:null,crossDomain:!1,autoUpdateMinutes:0};Object.defineProperty(this,"loader",{get:function(){return E},set:function(t){E=e.deepMerge(E,t)}}),S.$inject=["$rootScope","$q","$templateFactory","$injector","$stateParams","$location","$couchPotato","$http"],this.$get=S}var r="$match",i="abstract",s="$detour";angular.module("agt.detour").value("$stateParams",{}).provider(s,o)}),n("viewDirective",["./common","./detourModule","./detourProvider"],function(e){function t(t,n,r,i,s){var o;try{o=i.get("$animator")}catch(u){}var a={restrict:"ECA",terminal:!0,link:function(i,u,f){function m(e){var o=t.$current&&t.$current.locals[p];if(o===c)return;v&&e?v.leave(u.contents(),u):u.html(""),l&&(l.$destroy(),l=null);if(o){c=o,y.state=o.$$state;var a;v&&e?(a=angular.element("<div></div>").html(o.$template).contents(),v.enter(a,u)):(u.html(o.$template),a=u.contents());var f=n(a);l=i.$new();if(o.$$controller){o.$scope=l;var m=r(o.$$controller,o);u.children().data("$ngControllerController",m)}f(l),l.$emit("$viewContentLoaded"),l.$eval(d),s()}else c=null,y.state=null,e?v.enter(h,u):u.html(h)}var l,c,h=u.contents(),p=f[a.name]||f.name||"",d=f.onload||"",v=e.isDefined(o)&&o(i,f),g=u.parent().inheritedData("$uiView");p.indexOf("@")<0&&(p=p+"@"+(g?g.state.name:""));var y={name:p,state:null};u.data("$uiView",y),i.$on("$stateChangeSuccess",function(){m(!0)}),m(!1)}};return a}t.$inject=["$detour","$compile","$controller","$injector","$anchorScroll"],angular.module("agt.detour").directive("uiView",t)}),n("angular-detour",["./detourProvider","./viewDirective"],function(){}),t(["angular-detour"])})();